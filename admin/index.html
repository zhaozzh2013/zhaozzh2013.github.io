<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>åå°ç®¡ç† â€” æœ¬åœ° CMS</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    main{max-width:1000px;margin:36px auto;padding:18px}
    .grid{display:grid;gap:12px}
    .row{display:flex;gap:8px;align-items:center}
    textarea{min-height:80px}
    .small{font-size:0.9rem;color:var(--muted)}
    .list{margin-top:12px;border:1px solid var(--border);padding:12px;border-radius:8px;background:var(--card)}
    .item{display:flex;justify-content:space-between;align-items:center;padding:8px 4px;border-bottom:1px dashed rgba(0,0,0,0.03)}
    a.back{color:var(--accent);text-decoration:none;font-weight:600}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <img src="../icon.svg" class="brand-mark" alt="logo">
      <div>
        <h1>åå°</h1>
        <p>ç®¡ç†ä½ çš„æ–‡ç« ä¸ä½œå“</p>
      </div>
    </div>
    <nav class="site-nav">
      <a href="../index.html">ä¸»é¡µ</a>
    </nav>
    <div class="header-actions">
      <button id="navToggle2" class="nav-toggle" aria-label="åˆ‡æ¢å¯¼èˆª" aria-expanded="false">â˜°</button>
      <button id="themeToggle2" class="theme-toggle" aria-label="åˆ‡æ¢æš—é»‘æ¨¡å¼">ğŸŒ™</button>
    </div>
  </header>

  <main>
    <a class="back" href="../index.html">â† è¿”å›ä¸»é¡µ</a>
    <h1>åå°ç®¡ç†ï¼ˆæœ¬åœ°ï¼‰</h1>
    <p class="small">è¿™æ˜¯ä¸€ä¸ªçº¯å‰ç«¯çš„æœ¬åœ° CMSï¼Œæ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨çš„ localStorage ä¸­ï¼Œä»…åœ¨æœ¬æœºæœ‰æ•ˆã€‚</p>

    <section class="grid">
      <h2>å‘å¸ƒæ–‡ç« </h2>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
        <input id="newCategory" placeholder="æ·»åŠ æ–°åˆ†ç±»ï¼ˆä¾‹å¦‚ gameï¼‰">
        <button id="addCategory" class="button">æ·»åŠ åˆ†ç±»</button>
      </div>
      <div id="categoriesList" class="list"></div>
      <input id="postTitle" placeholder="æ ‡é¢˜">
      <input id="postCategory" placeholder="åˆ†ç±»ï¼ˆlife/design/workï¼‰">
      <textarea id="postBody" placeholder="æ­£æ–‡ï¼ˆçº¯æ–‡æœ¬ç¤ºä¾‹ï¼‰"></textarea>
      <div class="row">
        <button id="savePost" class="button">ä¿å­˜æ–‡ç« åˆ°æœ¬åœ°</button>
        <button id="exportPosts" class="button">å¯¼å‡º JSON</button>
      </div>
      <div id="postsList" class="list"></div>
    </section>

    <section class="grid" style="margin-top:18px;">
      <h2>ç®¡ç†æ¸¸æˆï¼ˆæ·»åŠ ä¸‹è½½é“¾æ¥ï¼‰</h2>
      <input id="gameTitle" placeholder="æ¸¸æˆæ ‡é¢˜">
      <input id="gameDesc" placeholder="ç®€çŸ­æè¿°">
      <input id="gameDownload" placeholder="ä¸‹è½½é“¾æ¥ï¼ˆç›¸å¯¹æˆ–ç»å¯¹ï¼‰ä¾‹å¦‚ ../downloads/pixel-car.zip">
      <div class="row">
        <button id="saveGame" class="button">ä¿å­˜æ¸¸æˆ</button>
        <button id="exportGames" class="button">å¯¼å‡º JSON</button>
      </div>
      <div id="gamesList" class="list"></div>
    </section>

    <section class="grid" style="margin-top:18px;">
      <h2>è”ç³»äººè®°å½•</h2>
      <p class="small">æ˜¾ç¤ºé€šè¿‡é¦–é¡µâ€œè”ç³»æˆ‘â€è¡¨å•æäº¤çš„è”ç³»äººä¿¡æ¯ï¼ˆä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼‰ã€‚</p>
      <div style="display:flex;gap:8px;align-items:center; margin-top:8px;">
        <button id="exportContacts" class="button">å¯¼å‡ºè”ç³»äºº</button>
        <button id="clearContacts" class="button">æ¸…ç©ºè”ç³»äºº</button>
      </div>
      <div id="contactsList" class="list"></div>
    </section>

    <section style="margin-top:18px;">
      <h2>ä½¿ç”¨è¯´æ˜</h2>
      <ol class="small">
        <li>ä¿å­˜åæ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼›è¦åœ¨ç«™ç‚¹ä¸­æ˜¾ç¤ºè¿™äº›å†…å®¹ï¼Œä½ å¯ä»¥å¤åˆ¶ HTML ç‰‡æ®µå¹¶ç²˜è´´åˆ° `index.html`ï¼Œæˆ–ä½¿ç”¨å¤åˆ¶ç‰‡æ®µåŠŸèƒ½ã€‚</li>
      </ol>
    </section>
  </main>

  <script>
    // ç®€æ˜“æœ¬åœ° CMSï¼ˆä¸æ ¹ç›®å½• admin.html åŠŸèƒ½ä¿æŒä¸€è‡´ï¼‰
    const postsKey = 'cms_posts';
    const gamesKey = 'cms_games';
    const catsKey = 'cms_categories';

    function load(key){
      try{return JSON.parse(localStorage.getItem(key) || '[]')}catch(e){return []}
    }
    function save(key,data){localStorage.setItem(key, JSON.stringify(data))}

    const postsList = document.getElementById('postsList');
    const gamesList = document.getElementById('gamesList');

    function renderPosts(){
      const items = load(postsKey);
      postsList.innerHTML = items.map((p, i)=>`<div class="item"><div><strong>${p.title}</strong><div class="small">${p.category} Â· ${p.body.slice(0,80)}...</div></div><div><button data-i="${i}" class="copyPost">å¤åˆ¶ç‰‡æ®µ</button> <button data-i="${i}" class="delPost">åˆ é™¤</button></div></div>`).join('') || '<p class="small">è¿˜æ²¡æœ‰æ–‡ç« ã€‚</p>';
      postsList.querySelectorAll('.delPost').forEach(btn=>btn.addEventListener('click', e=>{const i=e.target.dataset.i; const arr=load(postsKey); arr.splice(i,1); save(postsKey,arr); renderPosts()}));
      postsList.querySelectorAll('.copyPost').forEach(btn=>btn.addEventListener('click', e=>{const i=e.target.dataset.i; const p=load(postsKey)[i]; const snippet = `<article class="post-card" data-category="${p.category}">\n  <div>\n    <h3>${p.title}</h3>\n    <p>${p.body}</p>\n  </div>\n  <div class=\"post-meta\">\n    <span>${p.category}</span>\n    <span>${new Date().toISOString().split('T')[0]}</span>\n  </div>\n  <button class=\"save-btn\">æ”¶è—</button>\n</article>`; navigator.clipboard.writeText(snippet).then(()=>alert('æ–‡ç« ç‰‡æ®µå·²å¤åˆ¶åˆ°å‰ªè´´æ¿'))}))
    }

    function renderGames(){
      const items = load(gamesKey);
      gamesList.innerHTML = items.map((g, i)=>`<div class="item"><div><strong>${g.title}</strong><div class="small">${g.desc}</div></div><div><a class="button" href="${g.download}" download>ä¸‹è½½</a> <button data-i="${i}" class="copyGame">å¤åˆ¶ç‰‡æ®µ</button> <button data-i="${i}" class="delGame">åˆ é™¤</button></div></div>`).join('') || '<p class="small">è¿˜æ²¡æœ‰æ¸¸æˆã€‚</p>';
      gamesList.querySelectorAll('.delGame').forEach(btn=>btn.addEventListener('click', e=>{const i=e.target.dataset.i; const arr=load(gamesKey); arr.splice(i,1); save(gamesKey,arr); renderGames()}));
      gamesList.querySelectorAll('.copyGame').forEach(btn=>btn.addEventListener('click', e=>{const i=e.target.dataset.i; const g=load(gamesKey)[i]; const snippet = `<article class=\"work-card\" data-title=\"${g.title}\" data-desc=\"${g.desc}\">\n  <div class=\"thumb\"><img src=\"../icon.svg\" alt=\"${g.title} ç¼©ç•¥å›¾\"></div>\n  <h3>${g.title}</h3>\n  <p>${g.desc}</p>\n  <div class=\"work-actions\">\n    <a class=\"button\" href=\"${g.download}\">æ‰“å¼€</a>\n  </div>\n</article>`; navigator.clipboard.writeText(snippet).then(()=>alert('ä½œå“ç‰‡æ®µå·²å¤åˆ¶åˆ°å‰ªè´´æ¿'))}))
    }

    document.getElementById('savePost').addEventListener('click', ()=>{
      const title = document.getElementById('postTitle').value.trim();
      const category = document.getElementById('postCategory').value.trim() || 'life';
      const body = document.getElementById('postBody').value.trim();
      if(!title||!body){alert('è¯·å¡«å†™æ ‡é¢˜ä¸æ­£æ–‡');return}
      const arr = load(postsKey); arr.unshift({title,category,body}); save(postsKey,arr); renderPosts(); alert('æ–‡ç« å·²ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¯åœ¨â€œå¤åˆ¶ç‰‡æ®µâ€åç²˜è´´åˆ° `index.html`');
    });

    document.getElementById('saveGame').addEventListener('click', ()=>{
      const title = document.getElementById('gameTitle').value.trim();
      const desc = document.getElementById('gameDesc').value.trim();
      const download = document.getElementById('gameDownload').value.trim();
      if(!title||!download){alert('è¯·å¡«å†™æ ‡é¢˜ä¸ä¸‹è½½é“¾æ¥');return}
      const arr = load(gamesKey); arr.unshift({title,desc,download}); save(gamesKey,arr); renderGames(); alert('æ¸¸æˆå·²ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¯å¤åˆ¶ç‰‡æ®µç²˜è´´åˆ° `index.html` æˆ–ä½œå“é¡µé¢');
    });

    document.getElementById('exportPosts').addEventListener('click', ()=>{ const data=localStorage.getItem(postsKey)||'[]'; navigator.clipboard.writeText(data).then(()=>alert('æ–‡ç«  JSON å·²å¤åˆ¶'))});
    document.getElementById('exportGames').addEventListener('click', ()=>{ const data=localStorage.getItem(gamesKey)||'[]'; navigator.clipboard.writeText(data).then(()=>alert('æ¸¸æˆ JSON å·²å¤åˆ¶'))});

    renderPosts(); renderGames();
    // categories
    const catsKey = 'cms_categories';
    function loadCats(){ try{return JSON.parse(localStorage.getItem(catsKey)||'[]')}catch(e){return []} }
    function saveCats(v){ localStorage.setItem(catsKey, JSON.stringify(v)) }
    const categoriesList = document.getElementById('categoriesList');
    function renderCats(){ const arr=loadCats(); categoriesList.innerHTML = arr.map((c,i)=>`<div class="item"><div>${c}</div><div><button data-i="${i}" class="delCat">åˆ é™¤</button></div></div>`).join('')||'<p class="small">æ— åˆ†ç±»ã€‚</p>'; categoriesList.querySelectorAll('.delCat').forEach(btn=>btn.addEventListener('click', e=>{const i=e.target.dataset.i; const a=loadCats(); a.splice(i,1); saveCats(a); renderCats();})) }
    document.getElementById('addCategory').addEventListener('click', ()=>{ const v=document.getElementById('newCategory').value.trim(); if(!v){alert('è¯·è¾“å…¥åˆ†ç±»å');return} const a=loadCats(); if(!a.includes(v)){a.unshift(v); saveCats(a); renderCats(); alert('åˆ†ç±»å·²æ·»åŠ ')} else alert('åˆ†ç±»å·²å­˜åœ¨'); document.getElementById('newCategory').value=''; })
    renderCats();

    // contacts (from index contact form)
    const contactsList = document.getElementById('contactsList');
    function renderContacts(){ const s = JSON.parse(localStorage.getItem('contacts')||'[]'); contactsList.innerHTML = s.length? s.map(c=>`<div class="item"><div><strong>${c.name}</strong><div class="small">${c.email} ${c.phone? 'Â· ' + c.phone : ''}</div><div class="small">${c.message.slice(0,120)}</div></div></div>`).join('') : '<p class="small">æš‚æ— è”ç³»äººè®°å½•ã€‚</p>'; }
    document.getElementById('exportContacts').addEventListener('click', ()=>{ const s = localStorage.getItem('contacts')||'[]'; navigator.clipboard.writeText(s).then(()=>alert('è”ç³»äºº JSON å·²å¤åˆ¶')) });
    document.getElementById('clearContacts').addEventListener('click', ()=>{ if(confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰è”ç³»äººè®°å½•ï¼Ÿ')){ localStorage.removeItem('contacts'); renderContacts(); } });
    renderContacts();

    // ä¸»é¢˜åŒæ­¥ï¼šè¯»å–å¹¶åº”ç”¨ä¸»ç«™çš„ themeï¼Œæœ¬é¡µä¹Ÿå†™å›ç›¸åŒçš„ localStorage é”®
    const themeToggle2 = document.getElementById('themeToggle2');
    function applyAdminTheme() {
      const t = localStorage.getItem('theme') || 'light';
      document.body.classList.toggle('dark', t === 'dark');
      themeToggle2.textContent = t === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }
    themeToggle2.addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark');
      const newTheme = isDark ? 'dark' : 'light';
      localStorage.setItem('theme', newTheme);
      themeToggle2.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
    });
    // apply on load
    applyAdminTheme();
    // listen for external theme changes
    window.addEventListener('storage', (e) => {
      if (e.key === 'theme') applyAdminTheme();
    });
    // admin mobile nav toggle
    const navToggle2 = document.getElementById('navToggle2');
    if (navToggle2) {
      navToggle2.addEventListener('click', () => {
        const opened = document.body.classList.toggle('nav-open');
        navToggle2.setAttribute('aria-expanded', opened ? 'true' : 'false');
      });
      document.querySelectorAll('.site-nav a').forEach(a=>a.addEventListener('click', ()=>{
        if (document.body.classList.contains('nav-open')){
          document.body.classList.remove('nav-open');
          navToggle2.setAttribute('aria-expanded','false');
        }
      }));
    }
  </script>
</body>
</html>
*** End Patch